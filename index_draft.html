<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <!-- The title of the web page -->
  <title>Chicago Horse Railways and the Equine Influenza Outbreak of 1872</title>

  <!-- Link to Montserrat font -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Old+Standard+TT&display=swap" rel="stylesheet">
  <!-- Link the css files -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.css">
  <!-- Link to css for the info button -->
  <link rel="stylesheet" href="css/easy-button.css">
  <link rel='stylesheet' href='https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css'>

  <!-- The rest of the css -->
  <style>
    /* This declares the following code to be css */

    body {
      margin: 0px;
      height: 100%;
      width: 100%;
    }

    /* Add banner to header background */
    header {
      position: fixed;
      top: 0px;
      width: 100%;
      height: 52px;
      background-color: #000000;
      box-shadow: 0px 0px 5px black;
      z-index: 800;
    }

    /* Set font styles */
    h1 {
      font-family: 'Raleway', sans-serif;
      color: white;
      font-size: 18px;
      display: inline-block;
      margin-top: 0.5em;
      margin-bottom: 0.0em;
      margin-left: 0.5em;
      margin-right: 0;
      font-weight: bold;
      text-transform: uppercase;
    }

    h2 {
      font-family: 'Old Standard TT', serif;
      font-style: italic;
      font-size: 12px;
      color: white;
      display: inline-block;
      margin-top: 0.25em;
      margin-bottom: 0.0em;
      margin-left: 0.75em;
      margin-right: 0;
      font-weight: normal;
    }

    h3 {
      font-family: 'Raleway', sans-serif;
      padding: 0px;
      font-size: 16px;
      margin-left: 5px;
      font-weight: bold;
    }

    h4 {
      font-family: 'Old Standard TT', serif;
      font-style: italic;
      padding: 0px;
      font-size: 13px;
      line-height: 16px;
      font-weight: lighter;
    }

    h5 {
      font-family: 'Old Standard TT', serif;
      font-style: italic;
      padding-bottom: 0px;
      font-size: 13px;
      font-weight: lighter;
    }

    /* Set map parameters */
    #map {
      position: fixed;
      bottom: 0px;
      width: 100%;
      top: 52px;
    }

    /* Set time slider styles */
    #slider {
      position: absolute;
      height: 25px;
      bottom: 10px;
      left: 125px;
      z-index: 1000;
      background-color: #FFFFFF;
      border-radius: 3px;
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
    }

    /* Set temporal legend styles */
    #temporal {
      height: 25px;
      bottom: 10px;
      width: 90px;
      background-color: #FFFFFF;
      border-radius: 3px;
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
    }

    /* Set the styles for the text span in the temporal legend */
    #temporal span {
      font-family: 'Old Standard TT', serif;
      font-weight: normal;
      font-style: italic;
      position: absolute;
      font-size: 13px;
      bottom: 1px;
      left: 6px;
    }

    /* Add legend styles */
    .legend {
      padding: 0px 10px 6px 10px;
      background: white;
      background: rgba(255, 255, 255, 1.0);
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
      border-radius: 3px;
      position: absolute;
      bottom: 10px;
      right: 5px;
    }
    .temporal-legend {
      padding: 0px 10px 6px 10px;
      background: white;
      background: rgba(255, 255, 255, 1.0);
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
      border-radius: 3px;
    }

    .leaflet-control-layers-list {
      font-family: 'Old Standard TT', serif;
      font-weight: normal;
      font-style: italic;
      position: absolute;
      font-size: 13px;
    }

    .leaflet-control-scale {
		 	right: 200px;
		}

    /* Sort of works to restyle info window title -->
    div {
      font-family: 'Old Standard TT', serif;
    }
    */
  </style> <!-- Escape the css code -->

</head>

<body>
  <header>
    <h1>Chicago Horse Railways and the Equine Influenza Outbreak of 1872</h1><br>
    <h2>Jennifer Marks, The University of Iowa</h2>
  </header>

  <!-- The map will go inside this div below -->
  <div id="map"></div>

  <!-- ui sliders -->
  <div id='slider' class='leaflet-control'>
    <!-- Use the first and last year of the time data as the min and max. Set the initial value as the first year. Set the steps at one year. -->
    <input type='range' min="2405087" max="2405113" value="2405087" step="1" class="slider" />
  </div>

  <!-- temporal legends -->
  <div id='temporal'>
    <p class='txt-bold'><span></span></p>
  </div>

  <!-- button-dependent info window -->
  <div id="dialog" class="info" title="About this map">
    <h4>Please fill this area with explanatory text about the map, data, and data
      sources. You can also provide some background about your project and research
      activities.<br><br>
      Map Sources:<br>
      1. U.S. Lake Survey. "Chicago, Illinois 1872." Chicago, Illinois 1872 - American Geographical Society Library Digital Map Collection - UWM Libraries Digital Collections, American Geographical Society Library Digital Map Collection, 2008, https://collections.lib.uwm.edu/digital/collection/agdm/id/1332/.<br>
      2. Gray, O.W. "Grays Atlas Map of Chicago. 1873." Chicago - David Rumsey Historic Map Collection, Cartography Associates, 2020, https://www.davidrumsey.com/luna/servlet/detail/RUMSEY~8~1~264506~5524868.<br>
      3. Robinson, Elisha. "Robinson's Atlas of the City of Chicago." Robinson's Map of Chicago (Entire), 1886, Chicago Historical Society/Northwestern University, 2005, https://www.encyclopedia.chicagohistory.org/pages/11479.html.
    </h4>
  </div>
  <!-- end button-dependent info window -->

  <!-- Link to the js files -->
  <script src="https://code.jquery.com/jquery-3.2.0.min.js"></script>
  <script type="text/javascript" src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
  <script src='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.js'></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="js/MovingMarker.js"></script>
  <!-- for icon markers -->
  <script src="js/leaflet.extra-markers.min.js"></script>

  <!-- for info button support -->
  <script src='js/easy-button.js'></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <!-- The rest of the JavaScript -->
  <script>
    // Initialize the map
    var map = L.map('map', {
      center: [41.88035512871957, -87.6652759178263], // You can hardcode the center of the map on specific coordinates
      zoom: 13, // You can hardcode the initial zoom level
      minZoom: 10,
      maxZoom: 18
    });

    // Base layers
    // .. Voyager
    var voyager = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}.png', {
      minZoom: 10,
      maxZoom: 18,
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy;<a href="https://carto.com/attribution">CARTO</a>'
    }).addTo(map);

    // .. TMS
    var lyr1872 = L.tileLayer('./chicago_map_tiles/chicago_1872/{z}/{x}/{y}.png', {
      tms: true,
      opacity: 1.0,
      attribution: "",
      minZoom: 10,
      maxZoom: 15
    });
    var lyr1873 = L.tileLayer('./chicago_map_tiles/chicago_1873/{z}/{x}/{y}.png', {
      tms: true,
      opacity: 1.0,
      attribution: "",
      minZoom: 11,
      maxZoom: 15
    });
    var lyr1886 = L.tileLayer('./chicago_map_tiles/chicago_1886/{z}/{x}/{y}.png', {
      tms: true,
      opacity: 1.0,
      attribution: "",
      minZoom: 11,
      maxZoom: 18
    });
    //  .. void background
    var voidMap = L.tileLayer("", {
      minZoom: 10,
      maxZoom: 18
    });

    // Add a scale bar
    L.control.scale({
      position: 'bottomright' // Position the scale bar at the bottom-right corner
    }).addTo(map);

    // Load your data asynchronously
    d3.queue()
      .defer(d3.json, 'data/State.geojson') // Provide the path to your data file
      .defer(d3.json, 'data/Randolph_Bryan_Lake_Madison.geojson') // Add more files if needed
      .defer(d3.json, 'data/Archer.geojson') // Add more files if needed
      .defer(d3.json, 'data/Stock_Yards_41st.geojson') // Add more files if needed
      .defer(d3.json, 'data/Clark.geojson') // Add more files if needed
      .defer(d3.json, 'data/Halsted_Milwaukee.geojson') // Add more files if needed
      .defer(d3.json, 'data/Chicago.geojson') // Add more files if needed
      .defer(d3.json, 'data/Halsted_Blue_Island.geojson') // Add more files if needed
      .defer(d3.json, 'data/Division_Clybourn_Larrabee.geojson') // Add more files if needed
      .defer(d3.json, 'data/Sedgwick.geojson') // Add more files if needed
      .defer(d3.json, 'data/TwentySecond_Cottage_Grove.geojson') // Add more files if needed
      .defer(d3.json, 'data/Fifth.geojson') // Add more files if needed
      .defer(d3.json, 'data/Eighteenth_Indiana.geojson') // Add more files if needed
      .defer(d3.json, 'data/Clinton_12th_Jefferson_VanBuren.geojson') // Add more files if needed
      .defer(d3.json, 'data/Jefferson_Meagher.geojson') // Add more files if needed
      .defer(d3.json, 'data/South_Western.geojson') // Add more files if needed
      .defer(d3.json, 'data/Market.geojson') // Add more files if needed
      .defer(d3.json, 'data/epizootic_calendar_1.geojson')
      .await(drawMap); // Load the layers after the map loads

    // Provide instructions for drawing the map
    function drawMap(err, data1, data2, data3, data4, data5, data6, data7, data8,
      data9, data10, data11, data12, data13, data14, data15, data16, data17, stables) {

      // Create empty arrays for pushing up lat lng coordinates from each street car geojson
      var reversedLatLngsProcessed1 = [];
      var reversedLatLngsProcessed2 = [];
      var reversedLatLngsProcessed3 = [];
      var reversedLatLngsProcessed4 = [];
      var reversedLatLngsProcessed5 = [];
      var reversedLatLngsProcessed6 = [];
      var reversedLatLngsProcessed7 = [];
      var reversedLatLngsProcessed8 = [];
      var reversedLatLngsProcessed9 = [];
      var reversedLatLngsProcessed10 = [];
      var reversedLatLngsProcessed11 = [];
      var reversedLatLngsProcessed12 = [];
      var reversedLatLngsProcessed13 = [];
      var reversedLatLngsProcessed14 = [];
      var reversedLatLngsProcessed15 = [];
      var reversedLatLngsProcessed16 = [];
      var reversedLatLngsProcessed17 = [];

      var dataOne = L.geoJson(data1, { // Define the first data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed1.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataOne.resetStyle(e.target);

            },

          });
        },

      }); // End first layer

      var dataTwo = L.geoJson(data2, { // Define the second data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0];

          reversedLatLngs = [];

          for (var i = 0; i < initLatLngs.length; i++) {
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed2.push(reversedLatLngs);

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataTwo.resetStyle(e.target);

            },

          });
        },

      }); // End second layer

      var dataThree = L.geoJson(data3, { // Define the third data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0];

          reversedLatLngs = [];

          for (var i = 0; i < initLatLngs.length; i++) {
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed3.push(reversedLatLngs);

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataThree.resetStyle(e.target);

            },

          });
        },

      }); // End third layer

      var dataFour = L.geoJson(data4, { // Define the fourth data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0];

          reversedLatLngs = [];

          for (var i = 0; i < initLatLngs.length; i++) {
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed4.push(reversedLatLngs);

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataFour.resetStyle(e.target);

            },

          });
        },

      }); // End fourth layer

      var dataFive = L.geoJson(data5, { // Define the fifth data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed5.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataFive.resetStyle(e.target);

            },

          });
        },

      }); // End fifth layer

      var dataSix = L.geoJson(data6, { // Define the sixth data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed6.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataSix.resetStyle(e.target);

            },

          });
        },

      }); // End sixth layer

      var dataSeven = L.geoJson(data7, { // Define the seventh data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed7.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataSeven.resetStyle(e.target);

            },

          });
        },

      }); // End seventh layer

      var dataEight = L.geoJson(data8, { // Define the eighth data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed8.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataEight.resetStyle(e.target);

            },

          });
        },

      }); // End eighth layer

      var dataNine = L.geoJson(data9, { // Define the ninth data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed9.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataNine.resetStyle(e.target);

            },

          });
        },

      }); // End ninth layer

      var dataTen = L.geoJson(data10, { // Define the tenth data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed10.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataTen.resetStyle(e.target);

            },

          });
        },

      }); // End tenth layer

      var dataEleven = L.geoJson(data11, { // Define the eleventh data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed11.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataEleven.resetStyle(e.target);

            },

          });
        },

      }); // End eleventh layer

      var dataTwelve = L.geoJson(data12, { // Define the twelfth data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed12.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataTwelve.resetStyle(e.target);

            },

          });
        },

      }); // End twelfth layer

      var dataThirteen = L.geoJson(data13, { // Define the thirteenth data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed13.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataThirteen.resetStyle(e.target);

            },

          });
        },

      }); // End thirteenth layer

      var dataFourteen = L.geoJson(data14, { // Define the fourteenth data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed14.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataFourteen.resetStyle(e.target);

            },

          });
        },

      }); // End fourteenth layer

      var dataFifteen = L.geoJson(data15, { // Define the fifteenth data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed15.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataFifteen.resetStyle(e.target);

            },

          });
        },

      }); // End fifteenth layer

      var dataSixteen = L.geoJson(data16, { // Define the sixteenth data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed16.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataSixteen.resetStyle(e.target);

            },

          });
        },

      }); // End sixteenth layer

      var dataSeventeen = L.geoJson(data17, { // Define the seventeenth data layer with a variable

        // Style the layer
        style: function(feature) {
          return {
            color: '#1E3A51',
            weight: 2.5,
            opacity: 0.75,
            dashArray: "5,5",
            lineJoin: "round"
          };
        },

        // Restyle on mouseover, reset style on mouseout
        onEachFeature: function(feature, layer) {

          var initLatLngs = layer.feature.geometry.coordinates[0]; // Get the array of all coordinates (in original lng,lat format)

          reversedLatLngs = []; // Create an empty array into which you will push reversed coordinates in lat,lng format

          for (var i = 0; i < initLatLngs.length; i++) { // For each coordinate in initLatLngs...
            //...switch from lng,lat to lat,lng format and push to reversedLatLngs array
            reversedLatLngs.push([initLatLngs[i][1], initLatLngs[i][0]]);
          }

          reversedLatLngsProcessed17.push(reversedLatLngs); // Push the reversed coordinates to the reversedLatLngsProcessed array

          var props = layer.feature.properties; // Get the properties of the layer features

          // Bind a popup window to the layer
          layer.bindPopup("<h4>" + props.line + "</h4>");

          layer.on({

            // Define what happens on mouseover
            mouseover: function(e) {
              var layer = e.target;
              layer.setStyle({
                color: '#3232FF',
                weight: 3,
                opacity: 0.75
              });
            },

            // Define what happens on mouseout
            mouseout: function(e) {

              // Reset the layer styles
              dataSeventeen.resetStyle(e.target);

            },

          });
        },

      }); // End seventeenth layer

      // Get the number of line segments in each line geojson
      var multiplier1 = reversedLatLngsProcessed1[0].length - 1;
      var multiplier2 = reversedLatLngsProcessed2[0].length - 1;
      var multiplier3 = reversedLatLngsProcessed3[0].length - 1;
      var multiplier4 = reversedLatLngsProcessed4[0].length - 1;
      var multiplier5 = reversedLatLngsProcessed5[0].length - 1;
      var multiplier6 = reversedLatLngsProcessed6[0].length - 1;
      var multiplier7 = reversedLatLngsProcessed7[0].length - 1;
      var multiplier8 = reversedLatLngsProcessed8[0].length - 1;
      var multiplier9 = reversedLatLngsProcessed9[0].length - 1;
      var multiplier10 = reversedLatLngsProcessed10[0].length - 1;
      var multiplier11 = reversedLatLngsProcessed11[0].length - 1;
      var multiplier12 = reversedLatLngsProcessed12[0].length - 1;
      var multiplier13 = reversedLatLngsProcessed13[0].length - 1;
      var multiplier14 = reversedLatLngsProcessed14[0].length - 1;
      var multiplier15 = reversedLatLngsProcessed15[0].length - 1;
      var multiplier16 = reversedLatLngsProcessed16[0].length - 1;
      var multiplier17 = reversedLatLngsProcessed17[0].length - 1;

      // Assign a speed for the markers to travel over each line segment
      var speeds1 = ((', 100000'.repeat(multiplier1)).replace(', ', '')).split(', ').map(Number);
      var speeds2 = ((', 10000'.repeat(multiplier2)).replace(', ', '')).split(', ').map(Number);
      var speeds3 = ((', 10000'.repeat(multiplier3)).replace(', ', '')).split(', ').map(Number);
      var speeds4 = ((', 10000'.repeat(multiplier4)).replace(', ', '')).split(', ').map(Number);
      var speeds5 = ((', 10000'.repeat(multiplier5)).replace(', ', '')).split(', ').map(Number);
      var speeds6 = ((', 10000'.repeat(multiplier6)).replace(', ', '')).split(', ').map(Number);
      var speeds7 = ((', 10000'.repeat(multiplier7)).replace(', ', '')).split(', ').map(Number);
      var speeds8 = ((', 10000'.repeat(multiplier8)).replace(', ', '')).split(', ').map(Number);
      var speeds9 = ((', 10000'.repeat(multiplier9)).replace(', ', '')).split(', ').map(Number);
      var speeds10 = ((', 10000'.repeat(multiplier10)).replace(', ', '')).split(', ').map(Number);
      var speeds11 = ((', 10000'.repeat(multiplier11)).replace(', ', '')).split(', ').map(Number);
      var speeds12 = ((', 10000'.repeat(multiplier11)).replace(', ', '')).split(', ').map(Number);
      var speeds13 = ((', 10000'.repeat(multiplier13)).replace(', ', '')).split(', ').map(Number);
      var speeds14 = ((', 10000'.repeat(multiplier14)).replace(', ', '')).split(', ').map(Number);
      var speeds15 = ((', 10000'.repeat(multiplier15)).replace(', ', '')).split(', ').map(Number);
      var speeds16 = ((', 10000'.repeat(multiplier16)).replace(', ', '')).split(', ').map(Number);
      var speeds17 = ((', 10000'.repeat(multiplier16)).replace(', ', '')).split(', ').map(Number);

      var customIcon = L.ExtraMarkers.icon({
        //icon: 'fas fa-horse',
        //prefix: 'fa',
        //markerColor: 'blue-dark',
        innerHTML: '<img src="img/icon_streetcar_dg.png" width="60" height="50" style="vertical-align:bottom; position: relative; right:13px;">' // overrides icon with selected image
        //iconColor: 'white'
      });

      var marker1 = L.Marker.movingMarker(reversedLatLngsProcessed1[0], speeds1);
      marker1.setIcon(customIcon);
      marker1.on('mouseover', function() {
        marker1.bindPopup('<h4>State Street</h4>').openPopup();
      });
      marker1.on('mouseout', function() {
        marker1.closePopup();
      });
      marker1.once('click', function() {
        marker1.start();
        marker1.on('click', function() {
          if (marker1.isRunning()) {
            marker1.pause();
          } else {
            marker1.start();
          };
        });
        setTimeout(function() {
          marker1.bindPopup('<h4>State Street</h4>').openPopup();
        }, 100000);
      });

      var marker2 = L.Marker.movingMarker(reversedLatLngsProcessed2[0], speeds2);
      marker2.setIcon(customIcon);
      marker2.on('mouseover', function() {
        marker2.bindPopup('<h4>Randolph, Bryan, Lake, and Madison Streets</h4>').openPopup();
      });
      marker2.on('mouseout', function() {
        marker2.closePopup();
      });
      marker2.once('click', function() {
        marker2.start();
        marker2.on('click', function() {
          if (marker2.isRunning()) {
            marker2.pause();
          } else {
            marker2.start();
          };
        });
        setTimeout(function() {
          marker2.bindPopup('<h4>Randolph, Bryan, Lake, and Madison Streets</h4>').openPopup();
        }, 10000);
      });

      var marker3 = L.Marker.movingMarker(reversedLatLngsProcessed3[0], speeds3);
      marker3.setIcon(customIcon);
      marker3.on('mouseover', function() {
        marker3.bindPopup('<h4>Archer Avenue</h4>').openPopup();
      });
      marker3.on('mouseout', function() {
        marker3.closePopup();
      });
      marker3.once('click', function() {
        marker3.start();
        marker3.on('click', function() {
          if (marker3.isRunning()) {
            marker3.pause();
          } else {
            marker3.start();
          };
        });
        setTimeout(function() {
          marker3.bindPopup('<h4>Archer Avenue</h4>').openPopup();
        }, 10000);
      });

      var marker4 = L.Marker.movingMarker(reversedLatLngsProcessed4[0], speeds4);
      marker4.setIcon(customIcon);
      marker4.on('mouseover', function() {
        marker4.bindPopup('<h4>41st Street and Union Stock Yards</h4>').openPopup();
      });
      marker4.on('mouseout', function() {
        marker4.closePopup();
      });
      marker4.once('click', function() {
        marker4.start();
        marker4.on('click', function() {
          if (marker4.isRunning()) {
            marker4.pause();
          } else {
            marker4.start();
          };
        });
        setTimeout(function() {
          marker4.bindPopup('<h4>41st Street and Union Stock Yards</h4>').openPopup();
        }, 10000);
      });

      var marker5 = L.Marker.movingMarker(reversedLatLngsProcessed5[0], speeds5);
      marker5.setIcon(customIcon);
      marker5.on('mouseover', function() {
        marker5.bindPopup('<h4>Clark Street</h4>').openPopup();
      });
      marker5.on('mouseout', function() {
        marker5.closePopup();
      });
      marker5.once('click', function() {
        marker5.start();
        marker5.on('click', function() {
          if (marker5.isRunning()) {
            marker5.pause();
          } else {
            marker5.start();
          };
        });
        setTimeout(function() {
          marker5.bindPopup('<h4>Clark Street</h4>').openPopup();
        }, 10000);
      });

      var marker6 = L.Marker.movingMarker(reversedLatLngsProcessed6[0], speeds6);
      marker6.setIcon(customIcon);
      marker6.on('mouseover', function() {
        marker6.bindPopup('<h4>Halsted and Milwaukee Streets</h4>').openPopup();
      });
      marker6.on('mouseout', function() {
        marker6.closePopup();
      });
      marker6.once('click', function() {
        marker6.start();
        marker6.on('click', function() {
          if (marker6.isRunning()) {
            marker6.pause();
          } else {
            marker6.start();
          };
        });
        setTimeout(function() {
          marker6.bindPopup('<h4>Halsted and Milwaukee Streets</h4>').openPopup();
        }, 10000);
      });

      var marker7 = L.Marker.movingMarker(reversedLatLngsProcessed7[0], speeds7);
      marker7.setIcon(customIcon);
      marker7.on('mouseover', function() {
        marker7.bindPopup('<h4>Chicago Avenue</h4>').openPopup();
      });
      marker7.on('mouseout', function() {
        marker7.closePopup();
      });
      marker7.once('click', function() {
        marker7.start();
        marker7.on('click', function() {
          if (marker7.isRunning()) {
            marker7.pause();
          } else {
            marker7.start();
          };
        });
        setTimeout(function() {
          marker7.bindPopup('<h4>Chicago Avenue</h4>').openPopup();
        }, 10000);
      });

      var marker8 = L.Marker.movingMarker(reversedLatLngsProcessed8[0], speeds8);
      marker8.setIcon(customIcon);
      marker8.on('mouseover', function() {
        marker8.bindPopup('<h4>Halsted St. and Blue Island Ave.</h4>').openPopup();
      });
      marker8.on('mouseout', function() {
        marker8.closePopup();
      });
      marker8.once('click', function() {
        marker8.start();
        marker8.on('click', function() {
          if (marker8.isRunning()) {
            marker8.pause();
          } else {
            marker8.start();
          };
        });
        setTimeout(function() {
          marker8.bindPopup('<h4>Halsted St. and Blue Island Ave.</h4>').openPopup();
        }, 10000);
      });

      var marker9 = L.Marker.movingMarker(reversedLatLngsProcessed9[0], speeds9);
      marker9.setIcon(customIcon);
      marker9.on('mouseover', function() {
        marker9.bindPopup('<h4>Division, Clybourn, and Larrabee Streets</h4>').openPopup();
      });
      marker9.on('mouseout', function() {
        marker9.closePopup();
      });
      marker9.once('click', function() {
        marker9.start();
        marker9.on('click', function() {
          if (marker9.isRunning()) {
            marker9.pause();
          } else {
            marker9.start();
          };
        });
        setTimeout(function() {
          marker9.bindPopup('<h4>Division, Clybourn, and Larrabee Streets</h4>').openPopup();
        }, 10000);
      });

      var marker10 = L.Marker.movingMarker(reversedLatLngsProcessed10[0], speeds10);
      marker10.setIcon(customIcon);
      marker10.on('mouseover', function() {
        marker10.bindPopup('<h4>Sedgwick Street</h4>').openPopup();
      });
      marker10.on('mouseout', function() {
        marker10.closePopup();
      });
      marker10.once('click', function() {
        marker10.start();
        marker10.on('click', function() {
          if (marker10.isRunning()) {
            marker10.pause();
          } else {
            marker10.start();
          };
        });
        setTimeout(function() {
          marker10.bindPopup('<h4>Sedgwick Street</h4>').openPopup();
        }, 10000);
      });

      var marker11 = L.Marker.movingMarker(reversedLatLngsProcessed11[0], speeds11);
      marker11.setIcon(customIcon);
      marker11.on('mouseover', function() {
        marker11.bindPopup('<h4>22nd St. and Cottage Grove Ave.</h4>').openPopup();
      });
      marker11.on('mouseout', function() {
        marker11.closePopup();
      });
      marker11.once('click', function() {
        marker11.start();
        marker11.on('click', function() {
          if (marker11.isRunning()) {
            marker11.pause();
          } else {
            marker11.start();
          };
        });
        setTimeout(function() {
          marker11.bindPopup('<h4>22nd St. and Cottage Grove Ave.</h4>').openPopup();
        }, 10000);
      });

      var marker12 = L.Marker.movingMarker(reversedLatLngsProcessed12[0], speeds12);
      marker12.setIcon(customIcon);
      marker12.on('mouseover', function() {
        marker12.bindPopup('<h4>Fifth Avenue</h4>').openPopup();
      });
      marker12.on('mouseout', function() {
        marker12.closePopup();
      });
      marker12.once('click', function() {
        marker12.start();
        marker12.on('click', function() {
          if (marker12.isRunning()) {
            marker12.pause();
          } else {
            marker12.start();
          };
        });
        setTimeout(function() {
          marker12.bindPopup('<h4>Fifth Avenue</h4>').openPopup();
        }, 10000);
      });

      var marker13 = L.Marker.movingMarker(reversedLatLngsProcessed13[0], speeds13);
      marker13.setIcon(customIcon);
      marker13.on('mouseover', function() {
        marker13.bindPopup('<h4>Eighteenth St. and Indiana Ave.</h4>').openPopup();
      });
      marker13.on('mouseout', function() {
        marker13.closePopup();
      });
      marker13.once('click', function() {
        marker13.start();
        marker13.on('click', function() {
          if (marker13.isRunning()) {
            marker13.pause();
          } else {
            marker13.start();
          };
        });
        setTimeout(function() {
          marker13.bindPopup('<h4>Eighteenth St. and Indiana Ave.</h4>').openPopup();
        }, 10000);
      });

      var marker14 = L.Marker.movingMarker(reversedLatLngsProcessed14[0], speeds14);
      marker14.setIcon(customIcon);
      marker14.on('mouseover', function() {
        marker14.bindPopup('<h4>Clinton, 12th, Jefferson, & Van Buren Streets</h4>').openPopup();
      });
      marker14.on('mouseout', function() {
        marker14.closePopup();
      });
      marker14.once('click', function() {
        marker14.start();
        marker14.on('click', function() {
          if (marker14.isRunning()) {
            marker14.pause();
          } else {
            marker14.start();
          };
        });
        setTimeout(function() {
          marker14.bindPopup('<h4>Clinton, 12th, Jefferson, & Van Buren Streets</h4>').openPopup();
        }, 10000);
      });

      var marker15 = L.Marker.movingMarker(reversedLatLngsProcessed15[0], speeds15);
      marker15.setIcon(customIcon);
      marker15.on('mouseover', function() {
        marker15.bindPopup('<h4>Jefferson and Meagher Streets</h4>').openPopup();
      });
      marker15.on('mouseout', function() {
        marker15.closePopup();
      });
      marker15.once('click', function() {
        marker15.start();
        marker15.on('click', function() {
          if (marker15.isRunning()) {
            marker15.pause();
          } else {
            marker15.start();
          };
        });
        setTimeout(function() {
          marker15.bindPopup('<h4>Jefferson and Meagher Streets</h4>').openPopup();
        }, 10000);
      });

      var marker16 = L.Marker.movingMarker(reversedLatLngsProcessed16[0], speeds16);
      marker16.setIcon(customIcon);
      marker16.on('mouseover', function() {
        marker16.bindPopup('<h4>South Western Road</h4>').openPopup();
      });
      marker16.on('mouseout', function() {
        marker16.closePopup();
      });
      marker16.once('click', function() {
        marker16.start();
        marker16.on('click', function() {
          if (marker16.isRunning()) {
            marker16.pause();
          } else {
            marker16.start();
          };
        });
        setTimeout(function() {
          marker16.bindPopup('<h4>South Western Road</h4>').openPopup();
        }, 10000);
      });

      var marker17 = L.Marker.movingMarker(reversedLatLngsProcessed17[0], speeds17);
      marker17.setIcon(customIcon);
      marker17.on('mouseover', function() {
        marker17.bindPopup('<h4>Market Street</h4>').openPopup();
      });
      marker17.on('mouseout', function() {
        marker17.closePopup();
      });
      marker17.once('click', function() {
        marker17.start();
        marker17.on('click', function() {
          if (marker17.isRunning()) {
            marker17.pause();
          } else {
            marker17.start();
          };
        });
        setTimeout(function() {
          marker17.bindPopup('<h4>Market Street</h4>').openPopup();
        }, 10000);
      });

      // define the stables data
      var pointData = L.geoJson(stables);

      // make layer groups out of each streetcar line and marker
      var stateLine = L.layerGroup([dataOne, marker1]);
      var randolphLine = L.layerGroup([dataTwo, marker2]);
      var archerLine = L.layerGroup([dataThree, marker3]);
      var stockYardsLine = L.layerGroup([dataFour, marker4]);
      var clarkLine = L.layerGroup([dataFive, marker5]);
      var milwaukeeLine = L.layerGroup([dataSix, marker6]);
      var chicagoLine = L.layerGroup([dataSeven, marker7]);
      var blueIslandLine = L.layerGroup([dataEight, marker8]);
      var divisionLine = L.layerGroup([dataNine, marker9]);
      var sedgwickLine = L.layerGroup([dataTen, marker10]);
      var cottageGroveLine = L.layerGroup([dataEleven, marker11]);
      var fifthLine = L.layerGroup([dataTwelve, marker12]);
      var indianaLine = L.layerGroup([dataThirteen, marker13]);
      var clintonLine = L.layerGroup([dataFourteen, marker14]);
      var jeffersonLine = L.layerGroup([dataFifteen, marker15]);
      var southwesternLine = L.layerGroup([dataSixteen, marker16]);
      var marketLine = L.layerGroup([dataSeventeen, marker17]);

      // define the overlays
      var overlays = {
        "Horse Stables": pointData,
        "State": stateLine,
        "Randolph -- Madison": randolphLine,
        "Archer": archerLine,
        "41st -- Stock Yards": stockYardsLine,
        "Clark": clarkLine,
        "Halsted & Milwaukee": milwaukeeLine,
        "Chicago": chicagoLine,
        "Halsted & Blue Island": blueIslandLine,
        "Divison -- Larrabee": divisionLine,
        "Sedgwick": sedgwickLine,
        "22nd and Cottage Grove": cottageGroveLine,
        "Fifth": fifthLine,
        "Eighteenth & Indiana": indianaLine,
        "Clinton -- Van Buren": clintonLine,
        "Jefferson & Meagher": jeffersonLine,
        "South Western": southwesternLine,
        "Market": marketLine
      };

      // define the basemaps
      var basemaps = {
        "1872 Map": lyr1872,
        "1873 Map": lyr1873,
        "1886 Map": lyr1886,
        "Contemporary Map": voidMap
      };

      // make a layer control and add it to the map
      L.control.layers(basemaps, overlays).addTo(map);

      // create an info button to describe the map and supporting data
      var infoButton = L.easyButton({
        id: 'infoButton',
        position: 'topright',
        states: [{
          stateName: 'show-info',
          icon: '<strong>?</strong>',
          title: 'Tell me about this map',
          onClick: function(btn, map) {
            $("#dialog").dialog({
              //position: {
                //my: 'middle',
                //at: 'top+450'
              //},
              width: '400px',
            });
          }
        }]
      }).addTo(map);

      // declare a variable for the slider date
      var currentDate = $('.slider').val();

      sequenceUI(pointData); // Produces the time slider and sends the layer to it
      createTemporalLegend(currentDate); // Produces temporal legend upon map loading
      updateStables(pointData, currentDate); // Update the stables layer according to the date
      drawLegend();

    }; //end drawMap function

    function sequenceUI(pointData) { // Define sequenceUI

      // create Leaflet control for the slider
      var sliderControl = L.control({
        position: 'bottomleft',
        follow: true
      });

      // add controls to the slider
      sliderControl.onAdd = function(map) {

        var controls = L.DomUtil.get("slider"); // get the style settings

        // disable the mouse events and map dragging on mousedown
        L.DomEvent.addListener(controls, 'mousedown', function(e) {
          L.DomEvent.stopPropagation(e);
          map.dragging.disable();
        });

        // re-enable map dragging on mouseout
        L.DomEvent.addListener(slider, "mouseout", function(e) {
          map.dragging.enable();
        });

        return controls; // return the style settings

      }

      // add the control to the map
      sliderControl.addTo(map);

      $('.slider')
        .on('input change', function() {
          var currentDate = $(this).val(); // identifies the year selected
          createTemporalLegend(currentDate);
          updateStables(pointData, currentDate);
        });
    }; // End sequenceUI

    function createTemporalLegend(currentDate) { // Define createTemporalLegend

      var temporalLegend = L.control({
        position: 'bottomleft' // place the temporal legend at bottom left corner
      });

      // when added to the map
      temporalLegend.onAdd = function(map) {

        var div = L.DomUtil.get("temporal"); // get the style settings

        // disable the mouse events
        L.DomEvent.addListener(div, 'mousedown', function(e) {
          L.DomEvent.stopPropagation(e);
        });

        return div; // return the style settings

      }

      //convert the Julian Day Number to the Gregorian Calendar Date
      var X = parseFloat(currentDate) + 0.5;
      var Z = Math.floor(X); //Get day without time
      var F = X - Z; //Get time
      var Y = Math.floor((Z - 1867216.25) / 36524.25);
      var A = Z + 1 + Y - Math.floor(Y / 4);
      var B = A + 1524;
      var C = Math.floor((B - 122.1) / 365.25);
      var D = Math.floor(365.25 * C);
      var G = Math.floor((B - D) / 30.6001);
      //must get number less than or equal to 12)
      var month_p = (G < 13.5) ? (G - 1) : (G - 13);
      //if Month is January or February, or the rest of year
      var year = (month_p < 2.5) ? (C - 4715) : (C - 4716);
      month_p -= 1; //Handle JavaScript month format
      var month = month_p + 1
      var UT = B - D - Math.floor(30.6001 * G) + F;
      var day = Math.floor(UT);
      //Determine time
      UT -= Math.floor(UT);
      UT *= 24;
      var hour = Math.floor(UT);
      UT -= Math.floor(UT);
      UT *= 60;
      var minute = Math.floor(UT);
      //end conversion of Julian Day Number to Gregorian Calendar date

      $('#temporal span').html(month + "/" + day + "/" + year); //change grade value to that currently selected by UI slider

      temporalLegend.addTo(map); // add the temporal legend to the map

    }; // End createTemporalLegend

    function updateStables(pointData, currentDate) { // Define updateStables

      // Declare a variable for your custom icon and style
      var blackIcon = L.icon({
        iconUrl: 'img/icon_stable_simple_black.png', // local path to the desired icon image file
        iconSize: [20, 20], // size of the icon
        iconAnchor: [0, 0], // point of the icon which will correspond to marker's location
        popupAnchor: [7, 0] // point from which the popup should open relative to the iconAnchor
      });

      // Declare a variable for your custom icon and style
      var redIcon = L.icon({
        iconUrl: 'img/icon_stable_redwhite.png', // local path to the desired icon image file
        iconSize: [20, 20], // size of the icon
        iconAnchor: [0, 0], // point of the icon which will correspond to marker's location
        popupAnchor: [7, 0] // point from which the popup should open relative to the iconAnchor
      });

      pointData.eachLayer(function(layer) {
        var props = layer.feature.properties; // Define a properties variable called props
        var stableNotes = props[currentDate]; // Define a variable for notes about horse sickness at stables
        if (stableNotes === null) {
          layer.setIcon(blackIcon);
        } else {
          layer.setIcon(redIcon);
        }
        layer.bindPopup("<h4 style='font-size:12px; text-transform: uppercase; font-style: normal'>" + props.stable_name +
          "<h4>" + props.old_street_address +
          "<br>Number of Horses: " + props.horses +
          "<br>Notes: " + stableNotes + "</h4>"
        );
      });

    }; // End updateStables

    function drawLegend() { // Define drawLegend
      // Define legend as a control at the bottom right
      var legend = L.control({
        position: 'bottomright'
      });

      // Add content to the legend
      legend.onAdd = function(map) {

        var legendContainer = L.DomUtil.create("div", "legend");

        L.DomEvent.addListener(legendContainer, 'mousedown', function(e) {
          L.DomEvent.stopPropagation(e);
        });

        $(legendContainer).append("<h4 id='legendTitle' style='font-size:15px; font-style: normal; text-transform: uppercase; font-weight: bold'>Map Legend</h4>");

        var symbolsContainer = L.DomUtil.create('div', 'symbolsContainer'),
          grades = ["Stable", "Infected Stable"],
          labels = ["img/icon_stable_simple_black.png", "img/icon_stable_redwhite.png"];

        symbolsContainer.innerHTML +=
          "<h5><img src='img/icon_stable_simple_black.png' height='20' width='20' style='vertical-align: middle; padding: 5px'>" + '  Stable' + '<br>' +
          "<img src='img/icon_stable_redwhite.png' height='20' width='20' style='vertical-align: middle; padding: 5px'>" + '  Infected Stable' + '<br>' +
          '<img src="img/icon_streetcar_dg.png" width="30" height="30" style="vertical-align:bottom;">' + '    Streetcar Line' + '</h5>';

        $(legendContainer).append(symbolsContainer);

        return legendContainer;
      };
      // Add the legend to the map
      legend.addTo(map);

    }; // End drawLegend
  </script>
</body>

</html>
